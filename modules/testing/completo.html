<!doctype html>
<html>
  <head>
    <title>CodeMirror: Autocomplete Demo</title>
    <meta charset="utf-8"/>
    </script><!-- Requires CodeMirror from http://codemirror.net/ -->
    <link rel="stylesheet" href="/proteus/thirdparty/codemirror/lib/codemirror.css" type=
    "text/css">
    <script src="/proteus/thirdparty/codemirror/lib/codemirror.js" type=
    "text/javascript">
    </script>
    <script src="/proteus/thirdparty/codemirror/addon/edit/matchbrackets.js" type=
    "text/javascript">
    </script>
    <script src="/proteus/thirdparty/codemirror/mode/htmlmixed/htmlmixed.js" type=
    "text/javascript">
    </script>
    <script src="/proteus/thirdparty/codemirror/mode/xml/xml.js" type="text/javascript">
    </script>
    <script src="/proteus/thirdparty/codemirror/mode/javascript/javascript.js" type=
    "text/javascript">
    </script>
    <script src="/proteus/thirdparty/codemirror/mode/css/css.js" type="text/javascript">
    </script>
    <script src="/proteus/thirdparty/codemirror/mode/clike/clike.js" type=
    "text/javascript">
    </script>
    <script src="/proteus/thirdparty/codemirror/mode/php/php.js" type="text/javascript">
    </script><!-- End requirements of CodeMirror -->
    <script language="JavaScript" type="text/javascript">
    //<![CDATA[
    function toggle(source) {
      checkboxes = document.getElementsByName('snippetFile[]');
      for(var i=0, n=checkboxes.length;i<n;i++) {
        checkboxes[i].checked = source.checked;
      }
    }//]]>
    </script>
  </head>
  <body>
  <div id="pagewidth">
    <div id="header">
      <a href="/testing/index.php"><img src="/proteus/modules/testing/flask.png"
      height="64" width="64"></a> <span class="c1">%{title}%</span>
    </div>
    <div id="footer">
      <form>
	<fieldset>
	  <legend>codice:</legend>
	  <textarea id="code" name="code">
function getCompletions(token, context) {
  var found = [], start = token.string;
  function maybeAdd(str) {
    if (str.indexOf(start) == 0) found.push(str);
  }
  function gatherCompletions(obj) {
    if (typeof obj == "string") forEach(stringProps, maybeAdd);
    else if (obj instanceof Array) forEach(arrayProps, maybeAdd);
    else if (obj instanceof Function) forEach(funcProps, maybeAdd);
    for (var name in obj) maybeAdd(name);
  }

  if (context) {
    // If this is a property, see if it belongs to some object we can
    // find in the current environment.
    var obj = context.pop(), base;
    if (obj.className == "js-variable")
      base = window[obj.string];
    else if (obj.className == "js-string")
      base = "";
    else if (obj.className == "js-atom")
      base = 1;
    while (base != null && context.length)
      base = base[context.pop().string];
    if (base != null) gatherCompletions(base);
  }
  else {
    // If not, just look in the window object and any local scope
    // (reading into JS mode internals to get at the local variables)
    for (var v = token.state.localVars; v; v = v.next) maybeAdd(v.name);
    gatherCompletions(window);
    forEach(keywords, maybeAdd);
  }
  return found;
}
	  </textarea>
	  <label for="snippetFile">%{fileName}%:</label>
	  <input id="snippetFile" name="snippet" type="text" value="%{snippetFile}%" size="25">
	  <input type="submit" onclick="code.toggleEditor()" value="%{saveAndRun}%">
	  <input type="reset" value="%{revertChanges}%">
	  <input type="button" value="toggle editor" onclick="code.toggleEditor()">
	</fieldset>
      </form>
      <script type="text/javascript">
      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
	lineWrapping: true,
	lineNumbers: true,
	matchBrackets: true,
	extraKeys: {"Ctrl-Space": "autocomplete"},
	mode: {name: "javascript", globalVars: true}
      });
      </script>
      </div>
    </div>
  </body>
</html>
